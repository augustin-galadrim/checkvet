components: []
container:
  properties:
    html: |-
      <style>
        .bottom-buttons {
          position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
          width: 800px; max-width: 100%; background: #fff; padding: 15px 20px;
          display: flex; justify-content: center; gap: 20px;
          border-top: 1px solid #ddd; box-shadow: 0 -2px 4px rgba(0,0,0,0.1); z-index: 10;
        }
        .bottom-button {
          padding: 10px 30px; border: 1px solid #ddd; border-radius: 4px;
          background: #fff; cursor: pointer; font-size: 14px; transition: all 0.2s ease;
        }
        .bottom-button:hover { background: #f5f5f5; border-color: #999; }
        .primary-button { background-color: #4CAF50; color: white; border-color: #4CAF50; }
        .primary-button:hover { background-color: #45a049; }
        #reportFooter-button-share.disabled {
          background-color: #cccccc; color: #666666; cursor: not-allowed;
          pointer-events: none; border-color: #bbbbbb;
        }
        #status-modal {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background-color: rgba(0,0,0,0.5); z-index: 10010;
          display: none;
        }
        .status-modal-content {
          background-color: white; padding: 20px; width: 90%; max-width: 320px;
          border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        #status-modal-title {
          font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #333;
        }
        #status-options-list {
          display: flex; flex-direction: column; gap: 8px;
        }
        .status-option-btn {
          width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;
          background: #fff; cursor: pointer; text-align: left; font-size: 16px;
          transition: background-color 0.2s, border-color 0.2s;
        }
        .status-option-btn:hover {
          background-color: #f5f5f5; border-color: #4CAF50;
        }
      </style>

      <div class="bottom-buttons">
        <button class="bottom-button" id="reportFooter-button-status">Status</button>
        <button class="bottom-button" id="reportFooter-button-archive">Archive</button>
        <button class="bottom-button disabled" id="reportFooter-button-share">Share</button>
      </div>

      <div id="status-modal" class="modal">
        <div class="status-modal-content">
          <div id="status-modal-title">Choose status:</div>
          <div id="status-options-list">
          </div>
        </div>
      </div>

      <script>
        if (!window.__report_footer_globals) {
          window.__report_footer_globals = true;

          const logger = window.createLogger('ReportFooter');

          window.setFooterStatusText = function(newStatusText) {
            const statusBtn = document.getElementById('reportFooter-button-status');
            if (statusBtn) {
              statusBtn.textContent = newStatusText || 'Status';
            }
          };

          window.showStatusModal = function(title, options) {
            const titleEl = document.getElementById('status-modal-title');
            const listContainer = document.getElementById('status-options-list');

            if (!titleEl || !listContainer) {
              logger.error("Éléments de la modale de statut introuvables.");
              return;
            }

            titleEl.textContent = title;
            listContainer.innerHTML = '';

            options.forEach(opt => {
              const button = document.createElement('button');
              button.className = 'status-option-btn';
              button.textContent = opt.display;
              button.dataset.value = opt.value;

              button.addEventListener('click', (e) => {
                const selectedValue = e.currentTarget.dataset.value;
                anvil.call(document.getElementById('reportFooter-button-status'), 'handle_status_selection', selectedValue);
                window.closeModal('status-modal');
              });

              listContainer.appendChild(button);
            });

            window.openModal('status-modal');
          };

          window.attachFooterEvents = function() {
            logger.log('Attaching footer event listeners.');
            const reattach = (id, event, handler) => {
              const element = document.getElementById(id);
              if(element) {
                const newElement = element.cloneNode(true);
                element.parentNode.replaceChild(newElement, element);
                newElement.addEventListener('click', handler);
              } else {
                logger.warn(`Element with ID '${id}' not found for event attachment.`);
              }
            };

            reattach('reportFooter-button-status', 'click', (e) => {
              anvil.call(e.target, 'status_button_click');
            });

            reattach('reportFooter-button-archive', 'click', (e) => {
              anvil.call(e.target, 'save_button_click');
            });

            reattach('reportFooter-button-share', 'click', (e) => {
              anvil.call(e.target, 'share_button_click');
            });

            const modal = document.getElementById('status-modal');
            if (modal) {
              modal.addEventListener('click', (e) => {
                if (e.target.id === 'status-modal') {
                  window.closeModal('status-modal');
                }
              });
            }
          };
        }
      </script>
  type: HtmlTemplate
custom_component: true
events:
- default_event: true
  name: x_status_clicked
  parameters:
  - {name: status_key}
- {name: x_save_clicked}
- {name: x_share_clicked}
is_package: true
properties: []
