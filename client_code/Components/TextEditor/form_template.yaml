components: []
container:
  properties:
    html: "<div class=\"editor-section\">\n  <style>\n    .editor-section { background: #fff; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; }\n    #toolbar { padding: 10px; background: #f8f8f8; border-bottom: 1px solid #ddd; display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }\n    .toolbar-button { padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px; background: #fff; cursor: pointer; }\n    .toolbar-button:hover { background: #f5f5f5; }\n    .toolbar-button.active { background-color: #d0ebff; border-color: #66b0ff; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }\n    .toolbar-button svg { vertical-align: middle; }\n    #editor { min-height: 300px; padding: 20px; overflow-y: auto; font-size: 16px; line-height: 1.5; }\n    #editor p, #editor div { margin: 0; }\n    .toolbar-group { display: inline-flex; gap: 5px; }\n    .toolbar-button.disabled { background-color: #cccccc; color: #666666; cursor: not-allowed; pointer-events: none; border-color: #bbbbbb; }\n    .toolbar-button.disabled:hover { background-color: #cccccc; border-color: #bbbbbb; }\n    .image-editor-modal {\n      display: none;\n      position: fixed;\n      z-index: 10010;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      background-color: rgba(0,0,0,0.7);\n      align-items: center;\n      justify-content: center;\n    }\n    .image-editor-content {\n      background-color: #fff;\n      padding: 15px;\n      border-radius: 8px;\n      box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n      width: auto;\n      max-width: 95vw;\n      max-height: 90vh;\n      display: flex;\n      flex-direction: column;\n    }\n    .editor-canvas-container {\n      border: 1px solid #ccc;\n      margin-bottom: 10px;\n      position: relative;\n      overflow: hidden;\n      cursor: crosshair;\n      touch-action: none;\n    }\n    #base-canvas, #drawing-canvas {\n      position: absolute;\n      top: 0;\n      left: 0;\n    }\n    .editor-toolbar {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      padding: 10px;\n      background-color: #f1f1f1;\n      border-radius: 4px;\n      margin-bottom: 10px;\n      flex-wrap: wrap;\n    }\n    .editor-toolbar .tool-button {\n      padding: 8px 12px;\n      border: 1px solid #ccc;\n      background-color: #fff;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n    .editor-toolbar .tool-button.active {\n      background-color: #d0ebff;\n      border-color: #007bff;\n    }\n    .editor-toolbar input[type=\"color\"] {\n      border: none;\n      padding: 0;\n      width: 30px;\n      height: 30px;\n      cursor: pointer;\n      background: none;\n    }\n    .zoom-controls {\n      display: flex;\n      gap: 5px;\n      margin-left: 20px;\n    }\n    .editor-actions {\n      display: flex;\n      justify-content: flex-end;\n      gap: 10px;\n    }\n  </style>\n\n  <div id=\"toolbar\">\n    <div id=\"undoRedoButtons\" class=\"toolbar-group\">\n      <button id=\"textEditor-button-undo\" class=\"toolbar-button\" title=\"Undo\">‚Ü©Ô∏è</button>\n      <button id=\"textEditor-button-redo\" class=\"toolbar-button\" title=\"Redo\">‚Ü™Ô∏è</button>\n    </div>\n    <div id=\"styleButtons\" class=\"toolbar-group\">\n      <button id=\"textEditor-button-bold\" class=\"toolbar-button\" title=\"Bold\"><b>B</b></button>\n      <button id=\"textEditor-button-italic\" class=\"toolbar-button\" title=\"Italic\"><i>I</i></button>\n      <button id=\"textEditor-button-underline\" class=\"toolbar-button\" title=\"Underline\"><u>U</u></button>\n    </div>\n    <div id=\"alignButtons\" class=\"toolbar-group\">\n      <button id=\"textEditor-button-alignLeft\" class=\"toolbar-button\" title=\"Align Left\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\"><path fill=\"currentColor\" d=\"M1 3h14a1 1 0 0 1 0 2H1a1 1 0 0 1 0-2zm0 4h10a1 1 0 0 1 0 2H1a1 1 0 0 1 0-2zm0 4h14a1 1 0 0 1 0 2H1a1 1 0 0 1 0-2z\"/></svg></button>\n      <button id=\"textEditor-button-alignCenter\" class=\"toolbar-button\" title=\"Align Center\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\"><path fill=\"currentColor\" d=\"M3 3h10a1 1 0 0 1 0 2H3a1 1 0 0 1 0-2zm-2 4h14a1 1 0 0 1 0 2H1a1 1 0 0 1 0-2zm2 4h10a1 1 0 0 1 0 2H3a1 1 0 0 1 0-2z\"/></svg></button>\n      <button id=\"textEditor-button-alignRight\" class=\"toolbar-button\" title=\"Align Right\"><svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\"><path fill=\"currentColor\" d=\"M5 3h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2zM1 7h14a1 1 0 0 1 0 2H1a1 1 0 0 1 0-2zm4 4h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2z\"/></svg></button>\n    </div>\n    <input type=\"file\" id=\"image-file-input\" accept=\"image/png,image/jpeg,image/gif\" style=\"display: none;\">\n    <button id=\"textEditor-button-insertImage\" class=\"toolbar-button\">Image</button>\n    <span style=\"margin-left:auto;\"></span>\n    <button id=\"textEditor-button-copy\" class=\"toolbar-button\">Copy</button>\n    <button id=\"textEditor-button-export\" class=\"toolbar-button\">Export</button>\n  </div>\n  <div id=\"editor\" contenteditable=\"true\"></div>\n</div>\n\n<div id=\"image-editor-modal\" class=\"image-editor-modal\">\n  <div class=\"image-editor-content\" id=\"image-editor-content\">\n    <div class=\"editor-toolbar\">\n      <button class=\"tool-button active\" id=\"pen-tool\" title=\"Pen\">üñäÔ∏è</button>\n      <button class=\"tool-button\" id=\"eraser-tool\" title=\"Eraser\">üßº</button>\n      <input type=\"color\" id=\"color-picker\" value=\"#ff0000\" title=\"Pen Color\">\n      <div class=\"zoom-controls\">\n        <button class=\"tool-button\" id=\"zoom-out-btn\" title=\"Zoom Out\">-</button>\n        <button class=\"tool-button\" id=\"zoom-in-btn\" title=\"Zoom In\">+</button>\n      </div>\n      <div style=\"margin-left: auto;\">\n        <button class=\"tool-button\" id=\"clear-annotations-btn\" title=\"Clear Annotations\">üîÑ</button>\n      </div>\n    </div>\n    <div class=\"editor-canvas-container\" id=\"canvas-container\">\n      <canvas id=\"base-canvas\"></canvas>\n      <canvas id=\"drawing-canvas\"></canvas>\n    </div>\n    <div class=\"editor-actions\">\n      <button class=\"tool-button\" id=\"cancel-edit-btn\">Cancel</button>\n      <button class=\"tool-button\" id=\"validate-edit-btn\" style=\"background-color: #4CAF50; color: white;\">Validate</button>\n    </div>\n  </div>\n</div>\n\n<script>\n  if (!window.__editor_component_globals) {\n    window.__editor_component_globals = true;\n\n    const logger = window.createLogger('TextEditor');\n\n    let imageEditorState = {\n      baseCanvas: null,\n      drawingCanvas: null,\n      baseCtx: null,\n      drawingCtx: null,\n      isDrawing: false,\n      currentTool: 'pen',\n      currentColor: '#ff0000',\n      originalImageElement: null,\n      originalRefId: null,\n      lastX: 0,\n      lastY: 0,\n      scale: 1,\n      offscreenDrawingCanvas: null, \n      offscreenDrawingCtx: null,\n    };\n\n    function uuidv4() {\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n      });\n    }\n\n    window.getEditorContent = function() {\n      const editor = document.getElementById(\"editor\");\n      return editor ? editor.innerHTML : \"\";\n    };\n\n    window.setEditorContent = function(value) {\n      const editor = document.getElementById(\"editor\");\n      if (editor) {\n        if (value && !value.startsWith('<')) {\n          editor.innerHTML = `<div>${value.replace(/\\\\n/g, '</div><div>')}</div>`;\n        } else {\n          editor.innerHTML = value || \"\";\n        }\n      }\n    };\n\n    window.applyAlignment = function(align) {\n      document.execCommand('justify' + align.charAt(0).toUpperCase() + align.slice(1), false, null);\n    };\n\n    window.handleFileSelect = async function(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      const referenceId = uuidv4();\n      const timestamp = Date.now();\n\n      try {\n        await window.ImageStaging.stageImage(referenceId, file, timestamp);\n        const blobUrl = URL.createObjectURL(file);\n\n        const editor = document.getElementById('editor');\n        editor.focus();\n        document.execCommand('insertHTML', false, `<img src=\\\"${blobUrl}\\\" data-ref-id=\\\"${referenceId}\\\" style=\\\"max-width: 100%; height: auto;\\\">`);\n\n      } catch (error) {\n        logger.error('Failed to stage image:', error);\n        alert('Could not save image locally. Please try again.');\n      } finally {\n        event.target.value = null;\n      }\n    };\n\n    window.copyEditorContent = async function() {\n      const editor = document.getElementById(\"editor\");\n      if (!editor) {\n        window.createLogger('TextEditor').error(\"Editor element not found for copying.\");\n        return;\n      }\n\n      const htmlContent = editor.innerHTML;\n      const textContent = editor.innerText || editor.textContent;\n\n      if (navigator.clipboard && navigator.clipboard.write) {\n        try {\n          await navigator.clipboard.write([\n            new ClipboardItem({ \n              'text/html': new Blob([htmlContent], { type: 'text/html' }),\n              'text/plain': new Blob([textContent], { type: 'text/plain' })\n            })\n          ]);\n\n          if (window.displayBanner) {\n            window.displayBanner(\"Contenu format√© copi√© !\", \"success\");\n          }\n        } catch (err) {\n          console.error(\"√âchec de la copie avec l'API Clipboard:\", err);\n          fallbackCopy(editor);\n        }\n      } else {\n        fallbackCopy(editor);\n      }\n    };\n\n    function fallbackCopy(editor) {\n      let succeeded = false;\n      const listener = function(e) {\n        e.preventDefault();\n        e.clipboardData.setData('text/html', editor.innerHTML);\n        e.clipboardData.setData('text/plain', editor.innerText || editor.textContent);\n        succeeded = true;\n      };\n\n      document.addEventListener('copy', listener);\n      try {\n        document.execCommand('copy');\n      } catch (err) {\n        window.createLogger('TextEditor').error(\"Le repli de copie a √©chou√©:\", err);\n        succeeded = false;\n      } finally {\n        document.removeEventListener('copy', listener);\n      }\n\n      if (succeeded && window.displayBanner) {\n        window.displayBanner(\"Contenu format√© copi√© !\", \"success\");\n      } else if (window.displayBanner) {\n        window.displayBanner(\"√âchec de la copie du contenu.\", \"error\");\n      }\n    }\n    window.updateToolbarState = function() {\n      const simpleCommands = {\n        'textEditor-button-bold': 'bold',\n        'textEditor-button-italic': 'italic',\n        'textEditor-button-underline': 'underline'\n      };\n      for (const [buttonId, command] of Object.entries(simpleCommands)) {\n        const button = document.getElementById(buttonId);\n        if (button) {\n          try {\n            button.classList.toggle('active', document.queryCommandState(command));\n          } catch (e) { /* Fails in some edge cases, ignore */ }\n        }\n      }\n    };\n\n    window.openImageEditor = async function(imgElement) {\n      logger.log(\"Opening image editor for:\", imgElement);\n      const modal = document.getElementById('image-editor-modal');\n      imageEditorState.baseCanvas = document.getElementById('base-canvas');\n      imageEditorState.drawingCanvas = document.getElementById('drawing-canvas');\n      imageEditorState.baseCtx = imageEditorState.baseCanvas.getContext('2d');\n      imageEditorState.drawingCtx = imageEditorState.drawingCanvas.getContext('2d');\n      imageEditorState.originalImageElement = imgElement;\n      imageEditorState.originalRefId = imgElement.getAttribute('data-ref-id');\n\n      if (!imageEditorState.originalRefId) {\n        logger.error(\"Image does not have a data-ref-id. Cannot edit.\");\n        return;\n      }\n\n      try {\n        const blob = await window.ImageStaging.getStagedImageBlob(imageEditorState.originalRefId);\n        if (!blob) {\n          logger.error(\"Could not retrieve blob for refId:\", imageEditorState.originalRefId);\n          return;\n        }\n\n        const image = new Image();\n        image.onload = () => {\n          imageEditorState.baseCanvas.width = image.width;\n          imageEditorState.baseCanvas.height = image.height;\n          imageEditorState.drawingCanvas.width = image.width;\n          imageEditorState.drawingCanvas.height = image.height;\n\n          imageEditorState.offscreenDrawingCanvas = new OffscreenCanvas(image.width, image.height);\n          imageEditorState.offscreenDrawingCtx = imageEditorState.offscreenDrawingCanvas.getContext('2d');\n\n          imageEditorState.baseCtx.drawImage(image, 0, 0);\n\n          fitCanvasToContainer(image.width, image.height);\n\n          modal.style.display = 'flex';\n          URL.revokeObjectURL(image.src);\n        };\n        image.src = URL.createObjectURL(blob);\n\n        const canvas = imageEditorState.drawingCanvas;\n        canvas.addEventListener('mousedown', startDrawing);\n        canvas.addEventListener('mousemove', draw);\n        canvas.addEventListener('mouseup', stopDrawing);\n        canvas.addEventListener('mouseleave', stopDrawing);\n        canvas.addEventListener('touchstart', startDrawing, { passive: false });\n        canvas.addEventListener('touchmove', draw, { passive: false });\n        canvas.addEventListener('touchend', stopDrawing);\n\n      } catch (error) {\n        logger.error(\"Failed to load image into canvas:\", error);\n      }\n    };\n\n    function fitCanvasToContainer(imgWidth, imgHeight) {\n      const container = document.getElementById('canvas-container');\n      const content = document.getElementById('image-editor-content');\n\n      const maxWidth = content.clientWidth - 32;\n      const maxHeight = content.clientHeight - document.querySelector('.editor-toolbar').offsetHeight - document.querySelector('.editor-actions').offsetHeight - 50;\n\n      const scaleX = maxWidth / imgWidth;\n      const scaleY = maxHeight / imgHeight;\n      imageEditorState.scale = Math.min(scaleX, scaleY, 1);\n\n      applyCanvasTransforms();\n    }\n\n    function applyCanvasTransforms() {\n      const { baseCanvas, drawingCanvas, scale } = imageEditorState;\n      const displayWidth = baseCanvas.width * scale;\n      const displayHeight = baseCanvas.height * scale;\n\n      const container = document.getElementById('canvas-container');\n      container.style.width = `${displayWidth}px`;\n      container.style.height = `${displayHeight}px`;\n\n      [baseCanvas, drawingCanvas].forEach(c => {\n        c.style.width = `${displayWidth}px`;\n        c.style.height = `${displayHeight}px`;\n      });\n    }\n\n    function getCanvasCoordinates(e) {\n      e.preventDefault();\n      const canvas = imageEditorState.drawingCanvas;\n      const rect = canvas.getBoundingClientRect();\n\n      const clientX = e.touches ? e.touches[0].clientX : e.clientX;\n      const clientY = e.touches ? e.touches[0].clientY : e.clientY;\n\n      const scaleX = canvas.width / rect.width;\n      const scaleY = canvas.height / rect.height;\n\n      const canvasX = (clientX - rect.left) * scaleX;\n      const canvasY = (clientY - rect.top) * scaleY;\n\n      return { x: canvasX, y: canvasY };\n    }\n\n    function startDrawing(e) {\n      const { x, y } = getCanvasCoordinates(e);\n      imageEditorState.isDrawing = true;\n      [imageEditorState.lastX, imageEditorState.lastY] = [x, y];\n    }\n\n    function draw(e) {\n      if (!imageEditorState.isDrawing) return;\n      const { x, y } = getCanvasCoordinates(e);\n\n      const ctx = imageEditorState.offscreenDrawingCtx;\n\n      ctx.lineCap = 'round';\n      ctx.lineJoin = 'round';\n\n      if(imageEditorState.currentTool === 'pen') {\n        ctx.globalCompositeOperation = 'source-over';\n        ctx.strokeStyle = imageEditorState.currentColor;\n        ctx.lineWidth = 5;\n      } else if (imageEditorState.currentTool === 'eraser') {\n        ctx.globalCompositeOperation = 'destination-out';\n        ctx.lineWidth = 20;\n      }\n\n      ctx.beginPath();\n      ctx.moveTo(imageEditorState.lastX, imageEditorState.lastY);\n      ctx.lineTo(x, y);\n      ctx.stroke();\n\n      [imageEditorState.lastX, imageEditorState.lastY] = [x, y];\n\n      imageEditorState.drawingCtx.clearRect(0, 0, imageEditorState.drawingCanvas.width, imageEditorState.drawingCanvas.height);\n      imageEditorState.drawingCtx.drawImage(imageEditorState.offscreenDrawingCanvas, 0, 0);\n    }\n\n    function stopDrawing() {\n      imageEditorState.isDrawing = false;\n    }\n\n    window.closeImageEditor = function() {\n      logger.log(\"Closing image editor.\");\n      const modal = document.getElementById('image-editor-modal');\n      if (modal) modal.style.display = 'none';\n\n      if (imageEditorState.canvas) {\n        imageEditorState.canvas.removeEventListener('mousedown', startDrawing);\n        imageEditorState.canvas.removeEventListener('mousemove', draw);\n        imageEditorState.canvas.removeEventListener('mouseup', stopDrawing);\n        imageEditorState.canvas.removeEventListener('mouseleave', stopDrawing);\n        imageEditorState.ctx.clearRect(0, 0, imageEditorState.canvas.width, imageEditorState.canvas.height);\n      }\n\n      imageEditorState.originalImageElement = null;\n      imageEditorState.originalRefId = null;\n      imageEditorState.isDrawing = false;\n      imageEditorState.offscreenDrawingCanvas = null;\n      imageEditorState.offscreenDrawingCtx = null;\n    };\n\n    window.initializeEditor = function(retryCount = 0) {\n      logger.log(\"Initializing editor and attaching listeners.\");\n      try {\n        document.execCommand('defaultParagraphSeparator', false, 'p');\n      } catch (e) {\n        logger.warn(\"La commande 'defaultParagraphSeparator' n'est pas support√©e par ce navigateur.\");\n      }\n      const editorDiv = document.getElementById('editor');\n      if (!editorDiv) {\n        if (retryCount < 20) {\n          setTimeout(() => window.initializeEditor(retryCount + 1), 50);\n        } else {\n          logger.error(\"Fatal Error: #editor element not found after multiple retries.\");\n        }\n        return;\n      }\n\n      const addButtonListener = (buttonId, handler) => {\n        const button = document.getElementById(buttonId);\n        if (button) {\n          const newButton = button.cloneNode(true);\n          button.parentNode.replaceChild(newButton, button);\n          newButton.addEventListener('mousedown', (event) => {\n            event.preventDefault();\n            if (!newButton.disabled) { handler(); }\n          });\n        } else {\n          logger.warn(`Button #${buttonId} not found.`);\n        }\n      };\n\n      addButtonListener('textEditor-button-undo', () => anvil.call(editorDiv.closest('.anvil-container'), 'undo_change'));\n      addButtonListener('textEditor-button-redo', () => anvil.call(editorDiv.closest('.anvil-container'), 'redo_change'));\n      addButtonListener('textEditor-button-bold', () => { document.execCommand('bold', false, null); window.updateToolbarState(); });\n      addButtonListener('textEditor-button-italic', () => { document.execCommand('italic', false, null); window.updateToolbarState(); });\n      addButtonListener('textEditor-button-underline', () => { document.execCommand('underline', false, null); window.updateToolbarState(); });\n      addButtonListener('textEditor-button-alignLeft', () => { window.applyAlignment('left'); window.updateToolbarState(); });\n      addButtonListener('textEditor-button-alignCenter', () => { window.applyAlignment('center'); window.updateToolbarState(); });\n      addButtonListener('textEditor-button-alignRight', () => { window.applyAlignment('right'); window.updateToolbarState(); });\n      addButtonListener('textEditor-button-copy', window.copyEditorContent);\n      addButtonListener('textEditor-button-export', () => anvil.call(editorDiv.closest('.anvil-container'), 'export_content'));\n\n      const imageFileInput = document.getElementById('image-file-input');\n      if (imageFileInput) {\n        const newFileInput = imageFileInput.cloneNode(true);\n        imageFileInput.parentNode.replaceChild(newFileInput, imageFileInput);\n        newFileInput.addEventListener('change', window.handleFileSelect);\n      }\n\n      addButtonListener('textEditor-button-insertImage', () => {\n        const fileInput = document.getElementById('image-file-input');\n        if (fileInput) fileInput.click();\n      });\n\n      if (!editorDiv.dataset.stateListenersAttached) {\n        editorDiv.dataset.stateListenersAttached = 'true';\n        editorDiv.addEventListener('mouseup', window.updateToolbarState);\n        editorDiv.addEventListener('keyup', window.updateToolbarState);\n        editorDiv.addEventListener('focus', window.updateToolbarState);\n      }\n\n      if (!editorDiv.dataset.blurAttached) {\n        editorDiv.dataset.blurAttached = 'true';\n        editorDiv.addEventListener('blur', () => {\n          anvil.call(editorDiv.closest('.anvil-container'), 'on_blur_handler');\n        });\n      }\n\n      if (!editorDiv.dataset.imageClickListenerAttached) {\n        editorDiv.dataset.imageClickListenerAttached = 'true';\n        editorDiv.addEventListener('click', (event) => {\n          if (event.target.tagName === 'IMG' && event.target.hasAttribute('data-ref-id')) {\n            event.preventDefault();\n            window.openImageEditor(event.target);\n          }\n        });\n      }\n\n      if (!document.body.dataset.imageEditorListenersAttached) {\n        document.body.dataset.imageEditorListenersAttached = 'true';\n\n        document.getElementById('pen-tool').addEventListener('click', () => {\n          imageEditorState.currentTool = 'pen';\n          document.getElementById('pen-tool').classList.add('active');\n          document.getElementById('eraser-tool').classList.remove('active');\n        });\n        document.getElementById('eraser-tool').addEventListener('click', () => {\n          imageEditorState.currentTool = 'eraser';\n          document.getElementById('eraser-tool').classList.add('active');\n          document.getElementById('pen-tool').classList.remove('active');\n        });\n        document.getElementById('color-picker').addEventListener('input', (e) => {\n          imageEditorState.currentColor = e.target.value;\n        });\n\n        document.getElementById('zoom-in-btn').addEventListener('click', () => {\n          imageEditorState.scale = Math.min(imageEditorState.scale * 1.2, 3);\n          applyCanvasTransforms();\n          });\n          document.getElementById('zoom-out-btn').addEventListener('click', () => {\n          imageEditorState.scale = Math.max(imageEditorState.scale / 1.2, 0.1);\n          applyCanvasTransforms();\n          });\n\n          document.getElementById('clear-annotations-btn').addEventListener('click', () => {\n          if (confirm(\"Clear all drawings from this image?\")) {\n          imageEditorState.offscreenDrawingCtx.clearRect(0, 0, imageEditorState.offscreenDrawingCanvas.width, imageEditorState.offscreenDrawingCanvas.height);\n          imageEditorState.drawingCtx.clearRect(0, 0, imageEditorState.drawingCanvas.width, imageEditorState.drawingCanvas.height);\n          }\n          });\n\n          document.getElementById('cancel-edit-btn').addEventListener('click', window.closeImageEditor);\n\n          document.getElementById('validate-edit-btn').addEventListener('click', () => {\n          const mergeCanvas = new OffscreenCanvas(imageEditorState.baseCanvas.width, imageEditorState.baseCanvas.height);\n          const mergeCtx = mergeCanvas.getContext('2d');\n\n          mergeCtx.drawImage(imageEditorState.baseCanvas, 0, 0);\n          mergeCtx.drawImage(imageEditorState.offscreenDrawingCanvas, 0, 0);\n\n          mergeCanvas.convertToBlob({ type: 'image/png' }).then(async (blob) => {\n          await window.ImageStaging.stageImage(imageEditorState.originalRefId, blob, Date.now());\n          imageEditorState.originalImageElement.src = URL.createObjectURL(blob);\n          logger.log(\"Image updated successfully.\");\n          window.closeImageEditor();\n          });\n          });\n          }\n          };\n          }\n          </script>"
    visible: true
  type: HtmlTemplate
custom_component: true
is_package: true
properties:
- {default_binding_prop: true, default_value: true, important: true, name: show_image_button, type: boolean}
- {default_value: true, important: true, name: show_style_buttons, type: boolean}
- {default_value: true, important: true, name: show_copy_button, type: boolean}
- {default_value: true, important: true, name: show_align_buttons, type: boolean}
- {default_value: false, important: true, name: show_undo_redo_buttons, type: boolean}
- {default_value: '', important: true, name: show_export_button, type: string}
