components:
- layout_properties: {slot: time_display_slot}
  name: time_display_1
  properties: {}
  type: form:Components.TimeDisplay
container:
  data_bindings:
  - {code: '', property: tooltip, writeback: false}
  properties:
    html: "<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <style>\n      /* Global styles */\n      * {\n        box-sizing: border-box;\n        font-family: Arial, sans-serif;\n        margin: 0;\n        padding: 0;\n      }\n      body {\n        background-color: #f5f5f5;\n        height: 100vh;\n        overflow: hidden;\n      }\n      .header {\n        background: white;\n        padding: 20px;\n        border-bottom: 1px solid #ddd;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      .header h1 {\n        color: #333;\n        font-size: 24px;\n      }\n      .back-button {\n        background-color: #f1f1f1;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        padding: 8px 16px;\n        cursor: pointer;\n        transition: background-color 0.3s;\n      }\n      .back-button:hover {\n        background-color: #e1e1e1;\n      }\n\n      /* Tab Navigation */\n      .tabs {\n        display: flex;\n        background-color: #f8f8f8;\n        border-bottom: 1px solid #ddd;\n      }\n      .tab-btn {\n        padding: 12px 24px;\n        background: transparent;\n        border: none;\n        border-bottom: 3px solid transparent;\n        cursor: pointer;\n        font-size: 16px;\n        font-weight: 500;\n        transition: all 0.3s;\n      }\n      .tab-btn:hover {\n        background-color: #f1f1f1;\n      }\n      .tab-btn.active {\n        border-bottom-color: #4285f4;\n        color: #4285f4;\n      }\n\n      /* Content area */\n      .content {\n        flex: 1;\n        overflow-y: auto;\n        padding: 20px;\n        position: relative;\n      }\n\n      /* Tab panels */\n      .tab-panel {\n        display: none;\n      }\n      .tab-panel.active {\n        display: block;\n      }\n\n      /* Common components */\n      .action-bar {\n        margin-bottom: 20px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      .search-box {\n        padding: 8px 12px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        width: 300px;\n        font-size: 14px;\n      }\n      .action-button {\n        background-color: #4285f4;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        padding: 8px 16px;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 0.3s;\n      }\n      .action-button:hover {\n        background-color: #3367d6;\n      }\n      .secondary-button {\n        background-color: #f1f1f1;\n        color: #333;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        padding: 8px 16px;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 0.3s;\n      }\n      .secondary-button:hover {\n        background-color: #e1e1e1;\n      }\n\n      /* Table styles */\n      .data-table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 20px;\n      }\n      .data-table th {\n        background-color: #f8f8f8;\n        padding: 12px;\n        text-align: left;\n        font-weight: 600;\n        border-bottom: 2px solid #ddd;\n      }\n      .data-table td {\n        padding: 12px;\n        border-bottom: 1px solid #eee;\n      }\n      .data-table tr:hover {\n        background-color: #f5f5f5;\n      }\n      .data-table tr.clickable-row {\n        cursor: pointer;\n      }\n      .data-table .action-cell {\n        white-space: nowrap;\n        text-align: right;\n      }\n      .table-action {\n        background-color: transparent;\n        border: none;\n        color: #f44336;\n        cursor: pointer;\n        margin-left: 10px;\n        font-size: 14px;\n      }\n      .table-action:hover {\n        text-decoration: underline;\n      }\n\n      /* Form styles */\n      .form-container {\n        background-color: white;\n        border: 1px solid #ddd;\n        border-radius: 8px;\n        padding: 20px;\n        margin-bottom: 20px;\n      }\n      .form-title {\n        font-size: 18px;\n        font-weight: 600;\n        margin-bottom: 20px;\n        color: #333;\n      }\n      .form-group {\n        margin-bottom: 15px;\n      }\n      .form-group label {\n        display: block;\n        margin-bottom: 5px;\n        font-weight: 500;\n        color: #333;\n      }\n      .form-control {\n        width: 100%;\n        padding: 8px 12px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        font-size: 14px;\n      }\n      .form-check {\n        display: flex;\n        align-items: center;\n        margin-bottom: 15px;\n      }\n      .form-check input[type=\"checkbox\"] {\n        margin-right: 8px;\n      }\n      .form-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n        margin-top: 20px;\n      }\n\n      /* Form sections */\n      .form-section {\n        margin-bottom: 20px;\n        padding-bottom: 20px;\n        border-bottom: 1px solid #eee;\n      }\n      .form-section-title {\n        font-size: 16px;\n        font-weight: 600;\n        margin-bottom: 15px;\n        color: #555;\n      }\n      .form-row {\n        display: flex;\n        gap: 15px;\n        margin-bottom: 15px;\n      }\n      .form-col {\n        flex: 1;\n      }\n\n      /* User assignment container */\n      .user-assignment-container {\n        max-height: 200px;\n        overflow-y: auto;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        padding: 10px;\n        background-color: #f9f9f9;\n      }\n    </style>\n  </head>\n  <body>\n    <div class=\"responsive-container\" id=\"admin-container\">\n      <!-- Header -->\n      <div class=\"header\">\n        <h1>Administration</h1>\n        <button id=\"back-btn\" class=\"back-button\">Retour</button>\n      </div>\n\n      <!-- Tabs -->\n      <div class=\"tabs\">\n        <button id=\"tab-structures\" class=\"tab-btn active\" data-tab=\"structures\">Structures</button>\n        <button id=\"tab-users\" class=\"tab-btn\" data-tab=\"users\">Utilisateurs</button>\n        <button id=\"tab-templates\" class=\"tab-btn\" data-tab=\"templates\">Templates de Base</button>\n      </div>\n\n      <div class=\"content\">\n        <!-- Structures Tab Panel -->\n        <div id=\"structures-panel\" class=\"tab-panel active\">\n          <div class=\"action-bar\">\n            <input type=\"text\" class=\"search-box\" id=\"structure-search\" placeholder=\"Rechercher une structure...\">\n            <button id=\"new-structure-btn\" class=\"action-button\">Nouvelle Structure</button>\n          </div>\n          <table class=\"data-table\" id=\"structures-table\">\n            <thead>\n              <tr>\n                <th>Nom</th>\n                <th>T√©l√©phone</th>\n                <th>Email</th>\n                <th>V√©t√©rinaires Affili√©s</th>\n              </tr>\n            </thead>\n            <tbody id=\"structures-list\"></tbody>\n          </table>\n          <div id=\"structure-form\" class=\"form-container\" style=\"display: none;\">\n            <h2 class=\"form-title\" id=\"structure-form-title\">Nouvelle Structure</h2>\n            <div class=\"form-group\">\n              <label for=\"structure-name\">Nom de la Structure*</label>\n              <input type=\"text\" id=\"structure-name\" class=\"form-control\" required>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"structure-phone\">T√©l√©phone</label>\n              <input type=\"tel\" id=\"structure-phone\" class=\"form-control\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"structure-email\">Email</label>\n              <input type=\"email\" id=\"structure-email\" class=\"form-control\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"structure-address\">Adresse</label>\n              <textarea id=\"structure-address\" class=\"form-control\" rows=\"3\"></textarea>\n            </div>\n            <div class=\"form-actions\">\n              <button id=\"cancel-structure-btn\" class=\"secondary-button\">Annuler</button>\n              <button id=\"save-structure-btn\" class=\"action-button\">Enregistrer</button>\n            </div>\n          </div>\n          <div id=\"structure-vets\" class=\"form-container\" style=\"display: none;\">\n            <h2 class=\"form-title\">V√©t√©rinaires Affili√©s</h2>\n            <table class=\"data-table\" id=\"affiliated-vets-table\">\n              <thead>\n                <tr>\n                  <th>Nom</th>\n                  <th>Email</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody id=\"affiliated-vets-list\"></tbody>\n            </table>\n            <div class=\"form-section\" id=\"add-vet-section\" style=\"border-bottom: none; padding-bottom: 0;\">\n              <h3 class=\"form-section-title\">Ajouter un V√©t√©rinaire</h3>\n              <div class=\"form-row\">\n                <div class=\"form-col\">\n                  <div class=\"form-group\">\n                    <label for=\"add-vet-email\">Email du V√©t√©rinaire</label>\n                    <input type=\"email\" id=\"add-vet-email\" class=\"form-control\" placeholder=\"vet@example.com\">\n                  </div>\n                </div>\n                <div class=\"form-col\" style=\"flex: 0 0 auto; align-self: flex-end;\">\n                  <button id=\"add-vet-btn\" class=\"action-button\">Ajouter</button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Users Tab Panel -->\n        <div id=\"users-panel\" class=\"tab-panel\">\n          <div class=\"action-bar\">\n            <input type=\"text\" class=\"search-box\" id=\"user-search\" placeholder=\"Rechercher un utilisateur...\">\n            <button id=\"new-user-btn\" class=\"action-button\">Nouvel Utilisateur</button>\n          </div>\n          <table class=\"data-table\" id=\"users-table\">\n            <thead>\n              <tr>\n                <th>Nom</th>\n                <th>Email</th>\n                <th>T√©l√©phone</th>\n                <th>Structure</th>\n                <th>Superviseur</th>\n              </tr>\n            </thead>\n            <tbody id=\"users-list\"></tbody>\n          </table>\n          <div id=\"user-form\" class=\"form-container\" style=\"display: none;\">\n            <h2 class=\"form-title\" id=\"user-form-title\">Nouvel Utilisateur</h2>\n            <div class=\"form-section\">\n              <h3 class=\"form-section-title\">Informations de base</h3>\n              <div class=\"form-row\">\n                <div class=\"form-col\">\n                  <div class=\"form-group\">\n                    <label for=\"user-name\">Nom*</label>\n                    <input type=\"text\" id=\"user-name\" class=\"form-control\" required>\n                  </div>\n                </div>\n                <div class=\"form-col\">\n                  <div class=\"form-group\">\n                    <label for=\"user-email\">Email*</label>\n                    <input type=\"email\" id=\"user-email\" class=\"form-control\" required>\n                  </div>\n                </div>\n              </div>\n              <div class=\"form-row\">\n                <div class=\"form-col\">\n                  <div class=\"form-group\">\n                    <label for=\"user-phone\">T√©l√©phone</label>\n                    <input type=\"tel\" id=\"user-phone\" class=\"form-control\">\n                  </div>\n                </div>\n                <div class=\"form-col\">\n                  <div class=\"form-group\">\n                    <label for=\"user-structure\">Structure</label>\n                    <select id=\"user-structure\" class=\"form-control\">\n                      <option value=\"Ind√©pendant\">Ind√©pendant</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"form-section\" id=\"new-user-password-section\" style=\"display:none;\">\n              <h3 class=\"form-section-title\">Mot de passe</h3>\n              <div class=\"form-group\">\n                <label for=\"user-password\">Mot de passe (obligatoire pour les nouveaux utilisateurs)</label>\n                <div style=\"display: flex; gap: 10px;\">\n                  <input type=\"text\" id=\"user-password\" class=\"form-control\">\n                  <button type=\"button\" id=\"generate-password-btn\" class=\"secondary-button\">G√©n√©rer</button>\n                </div>\n              </div>\n            </div>\n            <div class=\"form-section\">\n              <h3 class=\"form-section-title\">Pr√©f√©rences & Autorisations</h3>\n              <div class=\"form-check\">\n                <input type=\"checkbox\" id=\"user-supervisor\">\n                <label for=\"user-supervisor\">Superviseur</label>\n              </div>\n              <div class=\"form-group\">\n                <label for=\"user-language\">Langue pr√©f√©r√©e</label>\n                <select id=\"user-language\" class=\"form-control\">\n                  <option value=\"fr\">Fran√ßais</option>\n                  <option value=\"en\" selected>Anglais</option>\n                </select>\n              </div>\n            </div>\n            <div class=\"form-actions\">\n              <button id=\"cancel-user-btn\" class=\"secondary-button\">Annuler</button>\n              <button id=\"save-user-btn\" class=\"action-button\">Enregistrer</button>\n            </div>\n            <div class=\"form-section\" id=\"user-templates-section\" style=\"display:none; border-bottom: none; padding-bottom: 0;\">\n              <h3 class=\"form-section-title\">Templates de l'utilisateur</h3>\n              <table class=\"data-table\" id=\"user-templates-table\">\n                <thead>\n                  <tr>\n                    <th>Nom du Template</th>\n                    <th>Langue</th>\n                  </tr>\n                </thead>\n                <tbody id=\"user-templates-list\"></tbody>\n              </table>\n            </div>\n            <div id=\"user-template-editor-section\" class=\"form-container\" style=\"display: none; margin-top: 20px;\">\n              <h2 class=\"form-title\" id=\"user-template-form-title\">Modifier le Template Utilisateur</h2>\n              <div class=\"form-section\">\n                <h3 class=\"form-section-title\">D√©tails du Template</h3>\n                <div class=\"form-group\">\n                  <label for=\"user-template-name\">Nom du Template*</label>\n                  <input type=\"text\" id=\"user-template-name\" class=\"form-control\" required>\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"user-template-language\">Langue</label>\n                  <select id=\"user-template-language\" class=\"form-control\">\n                    <option value=\"fr\">Fran√ßais</option>\n                    <option value=\"en\" selected>Anglais</option>\n                  </select>\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"user-template-text\">Contenu</label>\n                  <textarea id=\"user-template-text\" class=\"form-control\" rows=\"8\"></textarea>\n                </div>\n              </div>\n              <div class=\"form-actions\">\n                <button id=\"cancel-user-template-btn\" class=\"secondary-button\">Annuler</button>\n                <button id=\"save-user-template-btn\" class=\"action-button\">Enregistrer le Template</button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Templates Tab Panel -->\n        <div id=\"templates-panel\" class=\"tab-panel\">\n          <div class=\"action-bar\">\n            <input type=\"text\" class=\"search-box\" id=\"template-search\" placeholder=\"Rechercher un template de base...\">\n            <button id=\"new-template-btn\" class=\"action-button\">Nouveau Template de Base</button>\n          </div>\n          <table class=\"data-table\" id=\"templates-table\">\n            <thead>\n              <tr>\n                <th>Nom</th>\n                <th>Langue</th>\n                <th>Contenu</th>\n              </tr>\n            </thead>\n            <tbody id=\"templates-list\"></tbody>\n          </table>\n          <div id=\"template-form\" class=\"form-container\" style=\"display: none;\">\n            <h2 class=\"form-title\" id=\"template-form-title\">Nouveau Template de Base</h2>\n            <div class=\"form-section\">\n              <h3 class=\"form-section-title\">D√©tails du Template</h3>\n              <div class=\"form-group\">\n                <label for=\"template-name\">Nom du Template*</label>\n                <input type=\"text\" id=\"template-name\" class=\"form-control\" required>\n              </div>\n              <div class=\"form-group\">\n                <label for=\"template-language\">Langue</label>\n                <select id=\"template-language\" class=\"form-control\">\n                  <option value=\"fr\">Fran√ßais</option>\n                  <option value=\"en\" selected>Anglais</option>\n                </select>\n              </div>\n              <div class=\"form-group\">\n                <label for=\"template-text\">Contenu</label>\n                <textarea id=\"template-text\" class=\"form-control\" rows=\"8\"></textarea>\n              </div>\n            </div>\n            <div class=\"form-actions\">\n              <button id=\"cancel-template-btn\" class=\"secondary-button\">Annuler</button>\n              <button id=\"save-template-btn\" class=\"action-button\">Enregistrer le Template</button>\n            </div>\n            <div id=\"assignment-section\" class=\"form-section\">\n              <h3 class=\"form-section-title\">Assigner ce Template de Base</h3>\n              <p>Assigner ce template cr√©era une copie modifiable pour les utilisateurs s√©lectionn√©s.</p>\n              <div class=\"form-group\">\n                <label>Utilisateurs</label>\n                <div id=\"user-assignment-list\" class=\"user-assignment-container\"></div>\n              </div>\n              <div class=\"form-actions\">\n                <button id=\"assign-template-btn\" class=\"action-button\">Assigner aux Utilisateurs S√©lectionn√©s</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <script>\n      if (!window.__my_admin_globals) {\n        window.__my_admin_globals = true;\n\n        window.allData = { structures: [], users: [], templates: [] };\n        window.currentEditingMode = 'base';\n        window.currentTemplateId = null; \n        window.currentUserId = null;\n\n        const escapeHtml = (unsafe) => {\n          if (!unsafe) return '';\n          return unsafe.toString().replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n        };\n        const reattach = (id, event, handler) => {\n          const element = document.getElementById(id);\n          if (element) {\n            const newElement = element.cloneNode(true);\n            element.parentNode.replaceChild(newElement, element);\n            newElement.addEventListener(event, handler);\n          }\n        };\n\n        window.initializeData = (key, data) => {\n          window.allData[key] = data;\n          if (key === 'structures') populateStructures(data);\n          if (key === 'users') populateUsers(data);\n          if (key === 'templates') populateTemplates(data);\n        };\n        window.findDataById = (key, id) => {\n          const keyField = { structures: 'structure', users: 'id', templates: 'id' }[key];\n          return window.allData[key].find(item => item && item[keyField] == id);\n        };\n        window.getAllData = (key) => window.allData[key];\n        window.getCurrentEditingMode = () => window.currentEditingMode;\n\n        window.showTab = function(tabName) {\n          document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));\n          document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));\n          document.getElementById(`tab-${tabName}`).classList.add('active');\n          document.getElementById(`${tabName}-panel`).classList.add('active');\n          document.querySelectorAll('.form-container').forEach(form => form.style.display = 'none');\n        };\n\n        window.populateStructures = function(structures) {\n          const tableBody = document.getElementById('structures-list');\n          tableBody.innerHTML = '';\n          if (!structures || structures.length === 0) {\n            tableBody.innerHTML = '<tr><td colspan=\"4\" style=\"text-align: center;\">Aucune structure trouv√©e</td></tr>';\n            return;\n          }\n          structures.forEach(structure => {\n            const row = document.createElement('tr');\n            row.className = 'clickable-row';\n            const vetCount = structure.affiliated_vets || 0;\n            const vetText = (vetCount <= 1) ? 'v√©t√©rinaire' : 'v√©t√©rinaires';\n            row.innerHTML = `<td>${escapeHtml(structure.structure)}</td><td>${escapeHtml(structure.phone)}</td><td>${escapeHtml(structure.email)}</td><td>${vetCount} ${vetText}</td>`;\n            row.addEventListener('click', () => anvil.call(document.getElementById('admin-container'), 'get_structure_details', structure.structure));\n            tableBody.appendChild(row);\n          });\n        };\n        window.showStructureForm = (show = true) => {\n          document.getElementById('structure-form').style.display = show ? 'block' : 'none';\n          document.getElementById('structure-vets').style.display = 'none';\n        };\n        window.clearStructureForm = () => {\n          document.getElementById('structure-form-title').textContent = 'Nouvelle Structure';\n          ['structure-name', 'structure-phone', 'structure-email', 'structure-address'].forEach(id => document.getElementById(id).value = '');\n        };\n        window.displayStructureDetails = (structure) => {\n          document.getElementById('structure-form-title').textContent = 'Modifier la Structure';\n          document.getElementById('structure-name').value = structure.structure || '';\n          document.getElementById('structure-phone').value = structure.phone || '';\n          document.getElementById('structure-email').value = structure.email || '';\n          document.getElementById('structure-address').value = structure.address || '';\n          document.getElementById('structure-form').style.display = 'block';\n          document.getElementById('structure-vets').style.display = 'block';\n        };\n        window.displayAffiliatedVets = (vets) => {\n          const vetsList = document.getElementById('affiliated-vets-list');\n          vetsList.innerHTML = '';\n          if (!vets || vets.length === 0) {\n            vetsList.innerHTML = '<tr><td colspan=\"3\" style=\"text-align: center;\">Aucun v√©t√©rinaire affili√©.</td></tr>';\n            return;\n          }\n          vets.forEach(vet => {\n            const row = document.createElement('tr');\n            row.innerHTML = `<td>${escapeHtml(vet.name)}</td><td>${escapeHtml(vet.email)}</td><td class=\"action-cell\"><button class=\"table-action remove-vet-btn\" data-id=\"${vet.id}\">Retirer</button></td>`;\n            row.querySelector('.remove-vet-btn').addEventListener('click', (e) => {\n              e.stopPropagation();\n              if (confirm('√ätes-vous s√ªr de vouloir retirer ce v√©t√©rinaire de la structure ?')) {\n                anvil.call(document.getElementById('admin-container'), 'remove_vet_from_structure', vet.id);\n              }\n            });\n            vetsList.appendChild(row);\n          });\n        };\n\n        window.generateRandomPassword = (length = 12) => {\n          const chars = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()\";\n          let password = \"\";\n          for (let i = 0; i < length; i++) {\n            password += chars.charAt(Math.floor(Math.random() * chars.length));\n          }\n          document.getElementById('user-password').value = password;\n        };\n\n        window.populateUsers = (users) => {\n          const tableBody = document.getElementById('users-list');\n          tableBody.innerHTML = '';\n          if (!users || users.length === 0) {\n            tableBody.innerHTML = '<tr><td colspan=\"5\" style=\"text-align: center;\">Aucun utilisateur trouv√©</td></tr>';\n            return;\n          }\n          users.forEach(user => {\n            const row = document.createElement('tr');\n            row.className = 'clickable-row';\n            const structureDisplay = (user.structure === 'independent' || !user.structure) ? 'Ind√©pendant' : user.structure;\n            row.innerHTML = `<td>${escapeHtml(user.name)}</td><td>${escapeHtml(user.email)}</td><td>${escapeHtml(user.phone)}</td><td>${escapeHtml(structureDisplay)}</td><td>${user.supervisor ? 'Oui' : 'Non'}</td>`;\n            row.addEventListener('click', () => anvil.call(document.getElementById('admin-container'), 'get_user_details', user.id));\n            tableBody.appendChild(row);\n          });\n        };\n        window.showUserForm = (show = true, structures = []) => {\n          document.getElementById('user-form').style.display = show ? 'block' : 'none';\n          const structureSelect = document.getElementById('user-structure');\n          while (structureSelect.options.length > 1) { structureSelect.remove(1); }\n          structures.forEach(structure => {\n            if (structure !== 'Ind√©pendant') structureSelect.add(new Option(structure, structure));\n          });\n        };\n        window.clearUserForm = () => {\n          document.getElementById('user-form-title').textContent = 'Nouvel Utilisateur';\n          ['user-name', 'user-email', 'user-phone', 'user-password'].forEach(id => document.getElementById(id).value = '');\n          document.getElementById('user-structure').value = 'Ind√©pendant';\n          document.getElementById('user-supervisor').checked = false;\n          document.getElementById('user-language').value = 'en';\n          document.getElementById('new-user-password-section').style.display = 'block';\n          document.getElementById('user-templates-section').style.display = 'none';\n          document.getElementById('user-template-editor-section').style.display = 'none';\n        };\n        window.displayUserDetails = (user, structures, userTemplates) => {\n          window.currentUserId = user.id;\n          document.getElementById('user-form-title').textContent = 'Modifier Utilisateur';\n          document.getElementById('user-name').value = user.name || '';\n          document.getElementById('user-email').value = user.email || '';\n          document.getElementById('user-phone').value = user.phone || '';\n          document.getElementById('user-language').value = user.favorite_language || 'en';\n          document.getElementById('user-supervisor').checked = user.supervisor || false;\n          document.getElementById('new-user-password-section').style.display = 'none';\n          document.getElementById('user-template-editor-section').style.display = 'none';\n          showUserForm(true, structures);\n          document.getElementById('user-structure').value = (user.structure === 'independent' || !user.structure) ? 'Ind√©pendant' : user.structure;\n          displayUserTemplates(userTemplates);\n        };\n        window.displayUserTemplates = (templates) => {\n          const section = document.getElementById('user-templates-section');\n          const tableBody = document.getElementById('user-templates-list');\n          section.style.display = 'block';\n          tableBody.innerHTML = '';\n          if (!templates || templates.length === 0) {\n            tableBody.innerHTML = `<tr><td colspan=\"2\" style=\"text-align:center;\">Cet utilisateur n'a aucun template.</td></tr>`;\n            return;\n          }\n          const langToFlag = { 'en': 'üá¨üáß', 'fr': 'üá´üá∑' };\n          templates.forEach(t => {\n            const row = document.createElement('tr');\n            row.className = 'clickable-row';\n            const flag = langToFlag[t.language || 'en'] || 'üè≥Ô∏è';\n            row.innerHTML = `<td>${escapeHtml(t.name)}</td><td>${flag}</td>`;\n            row.addEventListener('click', () => anvil.call(document.getElementById('admin-container'), 'edit_user_template', t.id));\n            tableBody.appendChild(row);\n          });\n        };\n        window.displayUserTemplateEditor = (template) => {\n          window.currentTemplateId = template.id;\n          document.getElementById('user-template-form-title').textContent = `Modifier: ${escapeHtml(template.name)}`;\n          document.getElementById('user-template-name').value = template.name || '';\n          document.getElementById('user-template-text').value = template.html || '';\n          document.getElementById('user-template-language').value = template.language || 'en';\n          document.getElementById('user-template-editor-section').style.display = 'block';\n        };\n        window.hideUserTemplateEditor = () => {\n          document.getElementById('user-template-editor-section').style.display = 'none';\n        };\n\n        window.populateTemplates = (templates) => {\n          const tableBody = document.getElementById('templates-list');\n          tableBody.innerHTML = '';\n          if (!templates || templates.length === 0) {\n            tableBody.innerHTML = '<tr><td colspan=\"3\" style=\"text-align: center;\">Aucun template de base trouv√©</td></tr>';\n            return;\n          }\n          const langToFlag = { 'en': 'üá¨üáß', 'fr': 'üá´üá∑' };\n          templates.forEach(template => {\n            const row = document.createElement('tr');\n            row.className = 'clickable-row';\n            const flag = langToFlag[template.language || 'en'] || 'üè≥Ô∏è';\n            const truncatedHtml = escapeHtml(template.html).substring(0, 60) + (template.html && template.html.length > 60 ? '...' : '');\n            row.innerHTML = `<td>${escapeHtml(template.name)}</td><td>${flag}</td><td>${truncatedHtml}</td>`;\n            row.addEventListener('click', () => anvil.call(document.getElementById('admin-container'), 'get_template_details', template.id));\n            tableBody.appendChild(row);\n          });\n        };\n        window.showTemplateForm = (show = true, users = [], showAssignment = true) => {\n          document.getElementById('template-form').style.display = show ? 'block' : 'none';\n          document.getElementById('assignment-section').style.display = showAssignment ? 'block' : 'none';\n          const assignmentList = document.getElementById('user-assignment-list');\n          assignmentList.innerHTML = '';\n          if (users && users.length > 0) {\n            users.forEach(user => {\n              const userCheckbox = document.createElement('div');\n              userCheckbox.className = 'form-check';\n              userCheckbox.innerHTML = `<input type=\"checkbox\" id=\"user-${user.id}\" class=\"user-checkbox\" data-id=\"${user.id}\"><label for=\"user-${user.id}\">${escapeHtml(user.name)} (${escapeHtml(user.email)})</label>`;\n              assignmentList.appendChild(userCheckbox);\n            });\n          }\n        };\n        window.clearTemplateForm = () => {\n          document.getElementById('template-form-title').textContent = 'Nouveau Template de Base';\n          ['template-name', 'template-text'].forEach(id => document.getElementById(id).value = '');\n          document.getElementById('template-language').value = 'en';\n        };\n        window.displayTemplateDetails = (template, users, mode) => {\n          window.currentEditingMode = mode;\n          window.currentTemplateId = template.id;\n          document.getElementById('template-form-title').textContent = mode === 'base' ? 'Modifier Template de Base' : 'Modifier Template Utilisateur';\n          document.getElementById('template-name').value = template.name || '';\n          document.getElementById('template-text').value = template.html || '';\n          document.getElementById('template-language').value = template.language || 'en';\n          const showAssignment = (mode === 'base');\n          showTemplateForm(true, users, showAssignment);\n        };\n\n        window.__attachAdminEvents = function() {\n          document.querySelectorAll('.tab-btn').forEach(btn => reattach(btn.id, 'click', function() { showTab(this.getAttribute('data-tab')); }));\n          reattach('back-btn', 'click', (e) => anvil.call(e.target, 'back_to_home'));\n\n          reattach('structure-search', 'input', e => {\n            const query = e.target.value.toLowerCase();\n            const filtered = window.allData.structures.filter(s => Object.values(s).some(val => String(val).toLowerCase().includes(query)));\n            populateStructures(filtered);\n          });\n          reattach('user-search', 'input', e => {\n            const query = e.target.value.toLowerCase();\n            const filtered = window.allData.users.filter(u => Object.values(u).some(val => String(val).toLowerCase().includes(query)));\n            populateUsers(filtered);\n          });\n          reattach('template-search', 'input', e => {\n            const query = e.target.value.toLowerCase();\n            const filtered = window.allData.templates.filter(t => Object.values(t).some(val => String(val).toLowerCase().includes(query)));\n            populateTemplates(filtered);\n          });\n\n          reattach('new-structure-btn', 'click', (e) => anvil.call(e.target, 'new_structure'));\n          reattach('cancel-structure-btn', 'click', () => showStructureForm(false));\n          reattach('save-structure-btn', 'click', () => {\n            const data = { name: document.getElementById('structure-name').value, phone: document.getElementById('structure-phone').value, email: document.getElementById('structure-email').value, address: document.getElementById('structure-address').value };\n            anvil.call(document.getElementById('admin-container'), 'save_structure', data);\n          });\n          reattach('add-vet-btn', 'click', () => {\n            const email = document.getElementById('add-vet-email').value;\n            if (email) {\n              anvil.call(document.getElementById('admin-container'), 'add_vet_to_structure', email);\n              document.getElementById('add-vet-email').value = '';\n            } else { alert('Veuillez entrer un email.'); }\n          });\n\n          reattach('new-user-btn', 'click', (e) => anvil.call(e.target, 'new_user'));\n          reattach('cancel-user-btn', 'click', () => showUserForm(false));\n          reattach('generate-password-btn', 'click', window.generateRandomPassword);\n          reattach('save-user-btn', 'click', () => {\n            const data = { name: document.getElementById('user-name').value, email: document.getElementById('user-email').value, phone: document.getElementById('user-phone').value, structure: document.getElementById('user-structure').value, supervisor: document.getElementById('user-supervisor').checked, favorite_language: document.getElementById('user-language').value };\n            if (!window.currentUserId) {\n              data.password = document.getElementById('user-password').value;\n            }\n            anvil.call(document.getElementById('admin-container'), 'save_user', data);\n          });\n          reattach('cancel-user-template-btn', 'click', window.hideUserTemplateEditor);\n          reattach('save-user-template-btn', 'click', () => {\n            const data = { name: document.getElementById('user-template-name').value, html: document.getElementById('user-template-text').value, language: document.getElementById('user-template-language').value };\n            anvil.call(document.getElementById('admin-container'), 'save_custom_template', data);\n          });\n\n          reattach('new-template-btn', 'click', (e) => anvil.call(e.target, 'new_template'));\n          reattach('cancel-template-btn', 'click', () => showTemplateForm(false));\n          reattach('save-template-btn', 'click', () => {\n            const data = { name: document.getElementById('template-name').value, html: document.getElementById('template-text').value, language: document.getElementById('template-language').value };\n            if (window.currentEditingMode === 'base') {\n              anvil.call(document.getElementById('admin-container'), 'save_base_template', data);\n            } else {\n            anvil.call(document.getElementById('admin-container'), 'save_custom_template', data);\n          }\n          });\n            reattach('assign-template-btn', 'click', () => {\n            const userIds = Array.from(document.querySelectorAll('.user-checkbox:checked')).map(cb => cb.dataset.id);\n            if (window.currentTemplateId && userIds.length > 0) {\n            anvil.call(document.getElementById('admin-container'), 'assign_template_to_users', window.currentTemplateId, userIds);\n          } else {\n            alert(\"Template and at least one user must be selected for assignment.\");\n          }\n          });\n          };\n          }\n            window.__attachAdminEvents();\n            </script>\n  </body>\n</html>"
    tooltip: scsd
  type: HtmlTemplate
custom_component: false
is_package: true
