components:
- layout_properties: {slot: time_display_slot}
  name: time_display_1
  properties: {}
  type: form:Components.TimeDisplay
- layout_properties: {slot: default}
  name: header_nav_1
  properties: {active_tab: Settings}
  type: form:Components.HeaderNav
container:
  properties:
    html: "<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <style>\n      * { box-sizing: border-box; font-family: Arial, sans-serif; margin: 0; padding: 0; }\n      body { background-color: #f5f5f5; height: 100vh; overflow: hidden; }\n      .fixed-section { background: white; z-index: 10; }\n      .actions-row { display: flex; justify-content: flex-end; align-items: center; padding: 15px 20px; }\n      .scrollable-content { flex: 1; overflow-y: auto; padding: 20px; }\n      .settings-form { background-color: white; border-radius: 8px; }\n      .settings-section { background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 25px; }\n      .section-title { font-size: 18px; font-weight: 600; color: #333; margin-top: 0; margin-bottom: 20px; border-bottom: 1px solid #e0e0e0; padding-bottom: 10px; }\n      .form-row { display: flex; flex-wrap: wrap; gap: 20px; }\n      .form-group { flex: 1 1 100%; margin-bottom: 15px; }\n      .form-group.half-width { flex: 1 1 calc(50% - 10px); min-width: 250px; }\n      .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }\n      .form-group input[type=\"text\"], .form-group input[type=\"email\"], .form-group input[type=\"tel\"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }\n      .form-group input[readonly] { background-color: #f0f0f0; cursor: not-allowed; }\n      .structure-field-container { display: flex; align-items: center; gap: 10px; }\n      #settings-button-joinStructure { padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; white-space: nowrap; }\n      .button-group { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; }\n      .custom-button { padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; text-align: center; transition: background-color 0.3s; }\n      #settings-button-submit { background-color: #3974CB; color: white; }\n      #settings-button-cancel { background-color: #aaa; color: white; }\n      .custom-structure-button { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background-color: #fff; cursor: pointer; text-align: left; }\n      .modal { display: none; position: fixed; z-index: 20; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }\n      .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 400px; border-radius: 8px; }\n      .modal-close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }\n      .structure-option { padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin: 5px 0; cursor: pointer; background-color: #fff; }\n      .structure-option.selected { background-color: #d0ebff; border-color: #66b0ff; }\n      #settings-input-joinCode.error { border-color: #f44336; }\n      #join-code-error { color: #f44336; font-size: 12px; margin-top: 5px; display: none; }\n      .logout-footer { padding: 20px; border-top: 1px solid #ddd; background-color: #f8f8f8; text-align: center; margin-top: 20px; }\n      #settings-button-logout, #settings-button-admin { background-color: #f44336; color: white; border: none; border-radius: 4px; padding: 12px 24px; cursor: pointer; font-size: 14px; width: 100%; }\n      #settings-button-admin { background-color: #007bff; margin-bottom: 10px; display: none; font-weight: bold; border: 2px solid #0056b3; }\n      .branding-subsection { margin-bottom: 25px; }\n      .subsection-title { font-size: 16px; font-weight: 600; color: #444; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #eee; }\n      .asset-container { display: flex; flex-wrap: wrap; gap: 20px; align-items: center; }\n      .asset-preview { flex: 0 0 200px; height: 100px; background-color: #ffffff; border: 1px solid #ddd; border-radius: 4px; display: flex; align-items: center; justify-content: center; overflow: hidden; }\n      .asset-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }\n      .no-asset-msg { color: #777; font-size: 14px; }\n      .asset-controls { flex: 1 1 300px; }\n      .asset-instructions { font-size: 13px; color: #666; margin-bottom: 10px; }\n      .asset-buttons { display: flex; gap: 10px; }\n      .upload-button { background-color: #007bff !important; color: white !important; border: none !important; padding: 8px 12px !important; border-radius: 4px !important; cursor: pointer !important; font-size: 14px !important; }\n      .delete-button { background-color: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 14px; }\n    </style>\n  </head>\n  <body>\n    <div class=\"responsive-container\" id=\"settings-container\">\n      <div class=\"fixed-section\">\n        <div anvil-slot=\"default\"></div>\n        <div class=\"actions-row\">\n          <div anvil-slot=\"time_display_slot\"></div>\n        </div>\n      </div>\n      <div class=\"scrollable-content\">\n        <div class=\"settings-form\">\n          <form id=\"vet-settings-form\" onsubmit=\"return false;\">\n            <div class=\"settings-section\">\n              <h2 class=\"section-title\" id=\"settings-h2-vetInfoTitle\">Vet Information</h2>\n              <div class=\"form-row\">\n                <div class=\"form-group half-width\">\n                  <label for=\"settings-input-name\" id=\"settings-label-name\">Name</label>\n                  <input type=\"text\" id=\"settings-input-name\" required>\n                </div>\n                <div class=\"form-group half-width\">\n                  <label for=\"settings-input-phone\" id=\"settings-label-phone\">Phone</label>\n                  <input type=\"tel\" id=\"settings-input-phone\">\n                </div>\n              </div>\n              <div class=\"form-group\">\n                <label for=\"settings-input-email\" id=\"settings-label-email\">Email</label>\n                <input type=\"email\" id=\"settings-input-email\" readonly>\n              </div>\n            </div>\n\n            <div class=\"settings-section\">\n              <h2 class=\"section-title\" id=\"settings-h2-orgTitle\">Organization</h2>\n              <div class=\"form-group\">\n                <label for=\"settings-input-structureDisplay\" id=\"settings-label-structure\">Structure</label>\n                <div class=\"structure-field-container\">\n                  <input type=\"text\" id=\"settings-input-structureDisplay\" readonly>\n                  <button type=\"button\" id=\"settings-button-joinStructure\" style=\"display: none;\">Join</button>\n                </div>\n              </div>\n              <div id=\"supervisor-message\" style=\"display: none; font-style: italic; color: #333; margin-top: 10px; padding: 10px; background-color: #e9f5ff; border-left: 4px solid #007bff; border-radius: 4px;\">\n                <span id=\"settings-span-supervisorMessage\">You have the <strong>Supervisor</strong> role in your structure.</span>\n              </div>\n              <div class=\"form-group\" id=\"join-code-container\" style=\"display: none; margin-top: 15px;\">\n                <label for=\"settings-input-joinCode\" id=\"settings-label-joinCode\">Structure Join Code</label>\n                <input type=\"text\" id=\"settings-input-joinCode\" readonly>\n              </div>\n            </div>\n\n            <div class=\"settings-section\">\n              <h2 class=\"section-title\" id=\"settings-h2-pdfBrandingTitle\">PDF Export Branding</h2>\n\n              <!-- Sub-section for Personal Signature -->\n              <div class=\"branding-subsection\">\n                <h3 class=\"subsection-title\" id=\"settings-h3-mySignature\">My Signature</h3>\n                <div class=\"asset-container\" id=\"signature-asset-container\">\n                  <div class=\"asset-preview\">\n                    <img id=\"signature-preview-img\" src=\"\" alt=\"Signature Preview\" style=\"display: none;\">\n                    <span id=\"signature-no-asset-msg\" class=\"no-asset-msg\">No signature uploaded.</span>\n                  </div>\n                  <div class=\"asset-controls\">\n                    <p class=\"asset-instructions\" id=\"settings-p-signatureHelp\">Upload a PNG image with a transparent background for the best results.</p>\n                    <div class=\"asset-buttons\">\n                      <input type=\"file\" id=\"signature-file-input\" accept=\"image/png,image/jpeg\" style=\"display: none;\">\n                      <label for=\"signature-file-input\" class=\"upload-button\" id=\"settings-label-uploadSignature\">Upload New Signature</label>\n                      <button id=\"signature-delete-btn\" class=\"delete-button\" style=\"display: none;\">Delete</button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <!-- Sub-section for Structure Branding -->\n              <div class=\"branding-subsection\">\n                <h3 class=\"subsection-title\" id=\"settings-h3-structureBranding\">Structure Branding</h3>\n                <div id=\"structure-branding-controls\">\n                  <!-- Header Asset -->\n                  <div class=\"asset-container\" id=\"header-asset-container\">\n                    <div class=\"asset-preview\">\n                      <img id=\"header-preview-img\" src=\"\" alt=\"Header Preview\" style=\"display: none;\">\n                      <span id=\"header-no-asset-msg\" class=\"no-asset-msg\">No header uploaded.</span>\n                    </div>\n                    <div class=\"asset-controls\">\n                      <p class=\"asset-instructions\" id=\"settings-p-headerHelp\">This image will appear at the top of every page of your exported reports.</p>\n                      <div class=\"asset-buttons\">\n                        <input type=\"file\" id=\"header-file-input\" accept=\"image/png,image/jpeg\" style=\"display: none;\">\n                        <label for=\"header-file-input\" class=\"upload-button\" id=\"settings-label-uploadHeader\">Upload New Header</label>\n                        <button id=\"header-delete-btn\" class=\"delete-button\" style=\"display: none;\">Delete</button>\n                      </div>\n                    </div>\n                  </div>\n                  <!-- Footer Asset -->\n                  <div class=\"asset-container\" id=\"footer-asset-container\">\n                    <div class=\"asset-preview\">\n                      <img id=\"footer-preview-img\" src=\"\" alt=\"Footer Preview\" style=\"display: none;\">\n                      <span id=\"footer-no-asset-msg\" class=\"no-asset-msg\">No footer uploaded.</span>\n                    </div>\n                    <div class=\"asset-controls\">\n                      <p class=\"asset-instructions\" id=\"settings-p-footerHelp\">This image will appear at the bottom of every page of your exported reports.</p>\n                      <div class=\"asset-buttons\">\n                        <input type=\"file\" id=\"footer-file-input\" accept=\"image/png,image/jpeg\" style=\"display: none;\">\n                        <label for=\"footer-file-input\" class=\"upload-button\" id=\"settings-label-uploadFooter\">Upload New Footer</label>\n                        <button id=\"footer-delete-btn\" class=\"delete-button\" style=\"display: none;\">Delete</button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div id=\"structure-branding-disabled-msg\" style=\"display: none; font-style: italic; color: #555;\">\n                  <p id=\"settings-p-brandingManagedBy\">Branding is managed by your structure's supervisor.</p>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"settings-section\">\n              <h2 class=\"section-title\" id=\"settings-h2-prefsTitle\">Preferences</h2>\n              <div class=\"form-group\">\n                <label for=\"settings-button-favLanguage\" id=\"settings-label-favLanguage\">Favorite Language</label>\n                <input type=\"hidden\" id=\"favorite-language\" name=\"favorite_language_input\">\n                <button type=\"button\" id=\"settings-button-favLanguage\" class=\"custom-structure-button\">English</button>\n              </div>\n            </div>\n\n            <div class=\"settings-section\">\n              <h2 class=\"section-title\" id=\"settings-h2-toolsTitle\">Tools</h2>\n              <button type=\"button\" id=\"settings-button-micTest\" class=\"custom-structure-button\">Test My Microphone</button>\n              <button type=\"button\" id=\"settings-button-installGuide\" class=\"custom-structure-button\" style=\"margin-top: 10px;\">Show App Install Guide</button>\n            </div>\n\n            <div class=\"button-group\">\n              <button type=\"button\" id=\"settings-button-cancel\" class=\"custom-button\">Cancel</button>\n              <button type=\"button\" id=\"settings-button-submit\" class=\"custom-button\">Update Settings</button>\n            </div>\n          </form>\n        </div>\n        <div class=\"logout-footer\">\n          <button id=\"settings-button-admin\" class=\"custom-button\">Administration</button>\n          <button id=\"settings-button-logout\" class=\"custom-button\">Logout</button>\n        </div>\n      </div>\n    </div>\n\n    <div id=\"join-structure-modal\" class=\"modal\">\n      <div class=\"modal-content\">\n        <span id=\"join-modal-close\" class=\"modal-close\">×</span>\n        <h3 id=\"settings-h3-joinModalTitle\">Join a Structure</h3>\n        <p id=\"settings-p-joinModalDesc\">Enter the 6-digit join code provided by your structure's supervisor.</p>\n        <div class=\"form-group\">\n          <label for=\"settings-input-joinCodeModal\" id=\"settings-label-joinCodeModal\">Join Code</label>\n          <input type=\"text\" id=\"settings-input-joinCodeModal\" maxlength=\"6\">\n          <div id=\"join-code-error\">This code doesn't exist.</div>\n        </div>\n        <div class=\"button-group\">\n          <button id=\"settings-button-submitJoinCode\" class=\"custom-button\" style=\"background-color: #007bff; color: white;\">Join Structure</button>\n        </div>\n      </div>\n    </div>\n\n    <div id=\"favorite-language-modal\" class=\"modal\">\n      <div class=\"modal-content\">\n        <span id=\"favorite-language-modal-close\" class=\"modal-close\">×</span>\n        <h3 id=\"settings-h3-favLangModalTitle\">Select Favorite Language</h3>\n        <div id=\"favorite-language-options\"></div>\n      </div>\n    </div>\n\n    <script>\n      if (!window.__my_vet_settings_globals) {\n        window.__my_vet_settings_globals = true;\n\n        const logger = window.createLogger('SettingsForm');\n\n        window.showAdminButton = function(isAdmin) {\n          const adminBtn = document.getElementById(\"settings-button-admin\");\n          if (adminBtn) adminBtn.style.display = isAdmin ? \"block\" : \"none\";\n        };\n\n        window.updateSupervisorView = function(isSupervisor, joinCode) {\n          const supervisorMessage = document.getElementById(\"supervisor-message\");\n          const joinCodeContainer = document.getElementById(\"join-code-container\");\n          const joinCodeInput = document.getElementById(\"settings-input-joinCode\");\n\n          if (supervisorMessage) supervisorMessage.style.display = isSupervisor ? 'block' : 'none';\n          if (joinCodeContainer && joinCodeInput) {\n            if (isSupervisor && joinCode) {\n              joinCodeContainer.style.display = 'block';\n              joinCodeInput.value = joinCode;\n            } else {\n              joinCodeContainer.style.display = 'none';\n              joinCodeInput.value = '';\n            }\n          }\n        };\n\n        window.toggleJoinButton = function(show) {\n          const joinButton = document.getElementById(\"settings-button-joinStructure\");\n          if(joinButton) joinButton.style.display = show ? 'inline-block' : 'none';\n        };\n\n        window.populateFavoriteLanguageModal = function(options, current) {\n          const optionsContainer = document.getElementById(\"favorite-language-options\");\n          if (!optionsContainer) {\n            logger.warn(\"Impossible de trouver le conteneur 'favorite-language-options'. Le DOM a peut-être été retiré.\");\n            return;\n          }\n          optionsContainer.innerHTML = \"\";\n          options.forEach(opt => {\n            const optionElem = document.createElement(\"div\");\n            optionElem.classList.add(\"structure-option\");\n            optionElem.textContent = opt.display;\n            if (current && opt.value === current) optionElem.classList.add(\"selected\");\n            optionElem.addEventListener(\"click\", function(event) {\n              document.getElementById(\"favorite-language\").value = opt.value;\n              window.setElementText(\"settings-button-favLanguage\", opt.display);\n              window.closeModal('favorite-language-modal');\n            });\n            optionsContainer.appendChild(optionElem);\n          });\n        };\n\n\n        window.showJoinCodeError = function(message) {\n          const errorDiv = document.getElementById('join-code-error');\n          const input = document.getElementById('settings-input-joinCodeModal');\n          if(errorDiv) {\n            errorDiv.textContent = message || \"This code doesn't exist.\";\n            errorDiv.style.display = 'block';\n          }\n          if(input) input.classList.add('error');\n        };\n        window.hideJoinCodeError = function() {\n          document.getElementById('join-code-error').style.display = 'none';\n          document.getElementById('settings-input-joinCodeModal').classList.remove('error');\n        };\n\n        window.attachSettingsEvents = function() {\n          logger.log('Attaching settings event listeners.');\n          const settingsContainer = document.getElementById('settings-container');\n\n          const reattach = (id, event, handler) => {\n            const element = document.getElementById(id);\n            if(element) {\n              const newElement = element.cloneNode(true);\n              element.parentNode.replaceChild(newElement, element);\n              newElement.addEventListener(event, handler);\n            } else {\n              logger.warn(`Element with ID '${id}' not found for event attachment.`);\n            }\n          };\n\n          reattach('settings-button-submit', 'click', () => anvil.call(settingsContainer, 'submit_click'));\n          reattach('settings-button-cancel', 'click', () => anvil.call(settingsContainer, 'cancel_click'));\n          reattach(\"settings-button-favLanguage\", 'click', () => window.openModal('favorite-language-modal'));\n          reattach(\"favorite-language-modal-close\", 'click', () => window.closeModal('favorite-language-modal'));\n          reattach(\"settings-button-joinStructure\", 'click', () => window.openModal('join-structure-modal'));\n          reattach(\"join-modal-close\", 'click', () => window.closeModal('join-structure-modal'));\n          reattach('settings-button-submitJoinCode', 'click', () => {\n            hideJoinCodeError();\n            const code = document.getElementById('settings-input-joinCodeModal').value;\n            if (!code || code.trim().length !== 6) {\n              showJoinCodeError(\"Please enter a valid 6-character code.\");\n              return;\n            }\n            anvil.call(settingsContainer, 'attempt_to_join_structure', code).then(result => {\n              if (result && !result.success) {\n                showJoinCodeError(result.message);\n              } else {\n                closeJoinModal();\n              }\n            });\n          });\n\n          reattach(\"settings-button-micTest\", 'click', () => anvil.call(settingsContainer, 'openMicrophoneTest'));\n          reattach(\"settings-button-installGuide\", 'click', () => anvil.call(settingsContainer, 'show_install_guide_click'));\n          reattach(\"settings-button-logout\", 'click', () => anvil.call(settingsContainer, 'logout_click'));\n          reattach(\"settings-button-admin\", 'click', () => anvil.call(settingsContainer, 'openAdmin'));\n\n          const handleFileChange = (event, assetType) => {\n            const file = event.target.files[0];\n            if (file) {\n              anvil.call(settingsContainer, 'handle_asset_upload', file, assetType);\n            }\n            // Clear the input value to allow re-uploading the same file\n            event.target.value = null; \n          };\n\n          reattach('signature-file-input', 'change', (e) => handleFileChange(e, 'signature'));\n          reattach('header-file-input', 'change', (e) => handleFileChange(e, 'header'));\n          reattach('footer-file-input', 'change', (e) => handleFileChange(e, 'footer'));\n\n          const handleDeleteClick = (assetType) => {\n            anvil.call(settingsContainer, 'delete_asset_click', assetType);\n          };\n\n          reattach('signature-delete-btn', 'click', () => handleDeleteClick('signature'));\n          reattach('header-delete-btn', 'click', () => handleDeleteClick('header'));\n          reattach('footer-delete-btn', 'click', () => handleDeleteClick('footer'));\n        };\n      }\n\n      // Attach events every time the form is shown\n      window.attachSettingsEvents();\n\n      if (!window.__session_handlers_initialized) {\n        window.__session_handlers_initialized = true;\n        window.setupSessionHandlers();\n      }\n    </script>\n  </body>\n</html>"
  type: HtmlTemplate
is_package: true
